{"ast":null,"code":"import _classCallCheck from\"/Users/zhangjiahao/Starlink/starlink/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/zhangjiahao/Starlink/starlink/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/zhangjiahao/Starlink/starlink/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/zhangjiahao/Starlink/starlink/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from\"react\";import axios from\"axios\";import{Spin}from\"antd\";import{feature}from\"topojson-client\";import{geoKavrayskiy7}from\"d3-geo-projection\";import{geoGraticule,geoPath}from\"d3-geo\";import{select as d3Select}from\"d3-selection\";import{schemeCategory10}from\"d3-scale-chromatic\";import*as d3Scale from\"d3-scale\";import{timeFormat as d3TimeFormat}from\"d3-time-format\";import{BASE_URL,WORLD_MAP_URL,SATELLITE_POSITION_URL,SAT_API_KEY}from\"./constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var width=960;var height=600;var WorldMap=/*#__PURE__*/function(_Component){_inherits(WorldMap,_Component);var _super=_createSuper(WorldMap);function WorldMap(){var _this;_classCallCheck(this,WorldMap);_this=_super.call(this);_this.track=function(data){if(!data[0].hasOwnProperty(\"positions\")){throw new Error(\"no position data\");return;}var len=data[0].positions.length;var duration=_this.props.observerData.duration;var context2=_this.map.context2;var now=new Date();var i=0;var timer=setInterval(function(){var ct=new Date();var timePassed=i===0?0:ct-now;var time=new Date(now.getTime()+60*timePassed);context2.clearRect(0,0,width,height);context2.font=\"bold 14px sans-serif\";context2.fillStyle=\"#333\";context2.textAlign=\"center\";context2.fillText(d3TimeFormat(time),width/2,10);if(i>=len){clearInterval(timer);_this.setState({isDrawing:false});var oHint=document.getElementsByClassName(\"hint\")[0];oHint.innerHTML=\"\";return;}data.forEach(function(sat){var info=sat.info,positions=sat.positions;_this.drawSat(info,positions[i]);});i+=60;},1000);};_this.drawSat=function(sat,pos){var satlongitude=pos.satlongitude,satlatitude=pos.satlatitude;if(!satlongitude||!satlatitude)return;var satname=sat.satname;var nameWithNumber=satname.match(/\\d+/g).join(\"\");var _this$map=_this.map,projection=_this$map.projection,context2=_this$map.context2;var xy=projection([satlongitude,satlatitude]);context2.fillStyle=_this.color(nameWithNumber);context2.beginPath();context2.arc(xy[0],xy[1],4,0,2*Math.PI);context2.fill();context2.font=\"bold 11px sans-serif\";context2.textAlign=\"center\";context2.fillText(nameWithNumber,xy[0],xy[1]+14);};_this.generateMap=function(land){var projection=geoKavrayskiy7().scale(170).translate([width/2,height/2]).precision(0.1);var graticule=geoGraticule();var canvas=d3Select(_this.refMap.current).attr(\"width\",width).attr(\"height\",height);var canvas2=d3Select(_this.refTrack.current).attr(\"width\",width).attr(\"height\",height);var context=canvas.node().getContext(\"2d\");var context2=canvas2.node().getContext(\"2d\");var path=geoPath().projection(projection).context(context);land.forEach(function(ele){context.fillStyle=\"#B3DDEF\";context.strokeStyle=\"#000\";context.globalAlpha=0.7;context.beginPath();path(ele);context.fill();context.stroke();context.strokeStyle=\"rgba(220, 220, 220, 0.1)\";context.beginPath();path(graticule());context.lineWidth=0.1;context.stroke();context.beginPath();context.lineWidth=0.5;path(graticule.outline());context.stroke();});_this.map={projection:projection,graticule:graticule,context:context,context2:context2};};_this.state={isLoading:false,isDrawing:false};_this.map=null;_this.color=d3Scale.scaleOrdinal(schemeCategory10);_this.refMap=/*#__PURE__*/React.createRef();_this.refTrack=/*#__PURE__*/React.createRef();return _this;}_createClass(WorldMap,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;axios.get(WORLD_MAP_URL).then(function(res){var data=res.data;var land=feature(data,data.objects.countries).features;_this2.generateMap(land);}).catch(function(e){console.log(\"err in fetch map data \",e.message);});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState,snapshot){var _this3=this;if(prevProps.satData!==this.props.satData){var _this$props$observerD=this.props.observerData,latitude=_this$props$observerD.latitude,longitude=_this$props$observerD.longitude,elevation=_this$props$observerD.elevation,altitude=_this$props$observerD.altitude,duration=_this$props$observerD.duration;var endTime=duration*60;this.setState({isLoading:true});var urls=this.props.satData.map(function(sat){var satid=sat.satid;var url=\"\".concat(BASE_URL,\"/api/\").concat(SATELLITE_POSITION_URL,\"/\").concat(satid,\"/\").concat(latitude,\"/\").concat(longitude,\"/\").concat(elevation,\"/\").concat(endTime,\"/&apiKey=\").concat(SAT_API_KEY);return axios.get(url);});Promise.all(urls).then(function(res){var arr=res.map(function(sat){return sat.data;});_this3.setState({isLoading:false,isDrawing:true});if(!prevState.isDrawing){_this3.track(arr);}else{var oHint=document.getElementsByClassName(\"hint\")[0];oHint.innerHTML=\"Please wait for these satellite animation to finish before selection new ones!\";}}).catch(function(e){console.log(\"err in fetch satellite position -> \",e.message);});}}},{key:\"render\",value:function render(){var isLoading=this.state.isLoading;return/*#__PURE__*/_jsxs(\"div\",{className:\"map-box\",children:[isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",children:/*#__PURE__*/_jsx(Spin,{tip:\"Loading...\",size:\"large\"})}):null,/*#__PURE__*/_jsx(\"canvas\",{className:\"map\",ref:this.refMap}),/*#__PURE__*/_jsx(\"canvas\",{className:\"track\",ref:this.refTrack}),/*#__PURE__*/_jsx(\"div\",{className:\"hint\"})]});}}]);return WorldMap;}(Component);export default WorldMap;","map":{"version":3,"sources":["/Users/zhangjiahao/Starlink/starlink/src/components/WorldMap.js"],"names":["React","Component","axios","Spin","feature","geoKavrayskiy7","geoGraticule","geoPath","select","d3Select","schemeCategory10","d3Scale","timeFormat","d3TimeFormat","BASE_URL","WORLD_MAP_URL","SATELLITE_POSITION_URL","SAT_API_KEY","width","height","WorldMap","track","data","hasOwnProperty","Error","len","positions","length","duration","props","observerData","context2","map","now","Date","i","timer","setInterval","ct","timePassed","time","getTime","clearRect","font","fillStyle","textAlign","fillText","clearInterval","setState","isDrawing","oHint","document","getElementsByClassName","innerHTML","forEach","sat","info","drawSat","pos","satlongitude","satlatitude","satname","nameWithNumber","match","join","projection","xy","color","beginPath","arc","Math","PI","fill","generateMap","land","scale","translate","precision","graticule","canvas","refMap","current","attr","canvas2","refTrack","context","node","getContext","path","ele","strokeStyle","globalAlpha","stroke","lineWidth","outline","state","isLoading","scaleOrdinal","createRef","get","then","res","objects","countries","features","catch","e","console","log","message","prevProps","prevState","snapshot","satData","latitude","longitude","elevation","altitude","endTime","urls","satid","url","Promise","all","arr"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport axios from \"axios\";\nimport { Spin } from \"antd\";\nimport { feature } from \"topojson-client\";\nimport { geoKavrayskiy7 } from \"d3-geo-projection\";\nimport { geoGraticule, geoPath } from \"d3-geo\";\nimport { select as d3Select } from \"d3-selection\";\nimport { schemeCategory10 } from \"d3-scale-chromatic\";\nimport * as d3Scale from \"d3-scale\";\nimport { timeFormat as d3TimeFormat } from \"d3-time-format\";\n\nimport {\n    BASE_URL,\n    WORLD_MAP_URL,\n    SATELLITE_POSITION_URL,\n    SAT_API_KEY\n} from \"./constants\";\n\nconst width = 960;\nconst height = 600;\n\nclass WorldMap extends Component {\n    constructor() {\n        super();\n        this.state = {\n            isLoading: false,\n            isDrawing: false\n        };\n        this.map = null;\n        this.color = d3Scale.scaleOrdinal(schemeCategory10);\n        this.refMap = React.createRef();\n        this.refTrack = React.createRef();\n    }\n\n    componentDidMount() {\n        axios\n            .get(WORLD_MAP_URL)\n            .then(res => {\n                const { data } = res;\n                const land = feature(data, data.objects.countries).features;\n                this.generateMap(land);\n            })\n            .catch(e => {\n                console.log(\"err in fetch map data \", e.message);\n            });\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.satData !== this.props.satData) {\n            const {\n                latitude,\n                longitude,\n                elevation,\n                altitude,\n                duration\n            } = this.props.observerData;\n            const endTime = duration * 60;\n\n            this.setState({\n                isLoading: true\n            });\n\n            const urls = this.props.satData.map(sat => {\n                const { satid } = sat;\n                const url = `${BASE_URL}/api/${SATELLITE_POSITION_URL}/${satid}/${latitude}/${longitude}/${elevation}/${endTime}/&apiKey=${SAT_API_KEY}`;\n\n                return axios.get(url);\n            });\n\n            Promise.all(urls)\n                .then(res => {\n                    const arr = res.map(sat => sat.data);\n                    this.setState({\n                        isLoading: false,\n                        isDrawing: true\n                    });\n\n                    if (!prevState.isDrawing) {\n                        this.track(arr);\n                    } else {\n                        const oHint = document.getElementsByClassName(\"hint\")[0];\n                        oHint.innerHTML =\n                            \"Please wait for these satellite animation to finish before selection new ones!\";\n                    }\n                })\n                .catch(e => {\n                    console.log(\"err in fetch satellite position -> \", e.message);\n                });\n        }\n    }\n\n    track = data => {\n        if (!data[0].hasOwnProperty(\"positions\")) {\n            throw new Error(\"no position data\");\n            return;\n        }\n\n        const len = data[0].positions.length;\n        const { duration } = this.props.observerData;\n        const { context2 } = this.map;\n\n        let now = new Date();\n\n        let i = 0;\n\n        let timer = setInterval(() => {\n            let ct = new Date();\n\n            let timePassed = i === 0 ? 0 : ct - now;\n            let time = new Date(now.getTime() + 60 * timePassed);\n\n            context2.clearRect(0, 0, width, height);\n\n            context2.font = \"bold 14px sans-serif\";\n            context2.fillStyle = \"#333\";\n            context2.textAlign = \"center\";\n            context2.fillText(d3TimeFormat(time), width / 2, 10);\n\n            if (i >= len) {\n                clearInterval(timer);\n                this.setState({ isDrawing: false });\n                const oHint = document.getElementsByClassName(\"hint\")[0];\n                oHint.innerHTML = \"\";\n                return;\n            }\n\n            data.forEach(sat => {\n                const { info, positions } = sat;\n                this.drawSat(info, positions[i]);\n            });\n\n            i += 60;\n        }, 1000);\n    };\n\n    drawSat = (sat, pos) => {\n        const { satlongitude, satlatitude } = pos;\n\n        if (!satlongitude || !satlatitude) return;\n\n        const { satname } = sat;\n        const nameWithNumber = satname.match(/\\d+/g).join(\"\");\n\n        const { projection, context2 } = this.map;\n        const xy = projection([satlongitude, satlatitude]);\n\n        context2.fillStyle = this.color(nameWithNumber);\n        context2.beginPath();\n        context2.arc(xy[0], xy[1], 4, 0, 2 * Math.PI);\n        context2.fill();\n\n        context2.font = \"bold 11px sans-serif\";\n        context2.textAlign = \"center\";\n        context2.fillText(nameWithNumber, xy[0], xy[1] + 14);\n    };\n\n    render() {\n        const { isLoading } = this.state;\n        return (\n            <div className=\"map-box\">\n                {isLoading ? (\n                    <div className=\"spinner\">\n                        <Spin tip=\"Loading...\" size=\"large\" />\n                    </div>\n                ) : null}\n                <canvas className=\"map\" ref={this.refMap} />\n                <canvas className=\"track\" ref={this.refTrack} />\n                <div className=\"hint\" />\n            </div>\n        );\n    }\n\n    generateMap = land => {\n        const projection = geoKavrayskiy7()\n            .scale(170)\n            .translate([width / 2, height / 2])\n            .precision(0.1);\n\n        const graticule = geoGraticule();\n\n        const canvas = d3Select(this.refMap.current)\n            .attr(\"width\", width)\n            .attr(\"height\", height);\n\n        const canvas2 = d3Select(this.refTrack.current)\n            .attr(\"width\", width)\n            .attr(\"height\", height);\n\n        const context = canvas.node().getContext(\"2d\");\n        const context2 = canvas2.node().getContext(\"2d\");\n\n        let path = geoPath()\n            .projection(projection)\n            .context(context);\n\n        land.forEach(ele => {\n            context.fillStyle = \"#B3DDEF\";\n            context.strokeStyle = \"#000\";\n            context.globalAlpha = 0.7;\n            context.beginPath();\n            path(ele);\n            context.fill();\n            context.stroke();\n\n            context.strokeStyle = \"rgba(220, 220, 220, 0.1)\";\n            context.beginPath();\n            path(graticule());\n            context.lineWidth = 0.1;\n            context.stroke();\n\n            context.beginPath();\n            context.lineWidth = 0.5;\n            path(graticule.outline());\n            context.stroke();\n        });\n\n        this.map = {\n            projection: projection,\n            graticule: graticule,\n            context: context,\n            context2: context2\n        };\n    };\n}\n\nexport default WorldMap;\n\n"]},"metadata":{},"sourceType":"module"}